<script>
const out = document.getElementById('out');
document.getElementById('go').onclick = async ()=>{
  const token = document.getElementById('token').value.trim();
  if (!token) { out.textContent = 'Cole o token primeiro.'; return; }
  out.textContent = 'Conectando...';

  try{
    const r = await fetch('/api/debug/force-token', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ token })
    });

    const text = await r.text();
    let json;
    try { json = JSON.parse(text); }
    catch {
      out.textContent =
        'A API respondeu HTML (provável 502/Bad Gateway ao acordar).\n' +
        'Atualize a página, chame /api/ping e tente de novo.\n\n' +
        text.slice(0,500);
      return;
    }

    out.textContent = JSON.stringify(json, null, 2);
    if (json.ok) setTimeout(()=> location.href='/public/app.html#/dashboard', 800);
  }catch(e){
    out.textContent = 'Falha de rede: ' + String(e);
  }
};
</script>
